var l=(t,n)=>()=>(t&&(n=t(t=0)),n);var D=(t,n)=>()=>(n||t((n={exports:{}}).exports,n),n.exports);function p(){let{ffi:{proxy:t,toPy:n},abstr:{setUpModuleMethods:r,objectSetItem:i},misceval:{promiseToSuspension:o,chain:d}}=Sk,c={__name__:n("js"),window:t(self)};async function E(a){let s=await new Function("return import("+JSON.stringify(a.toString())+")").call(null);return t(s)}return r("js",c,{await_promise:{$meth(a){let s=a.valueOf();return s instanceof Promise||s&&s.then&&typeof s.then=="function"?d(o(s),T=>n(T,{dictHook:A=>t(A)})):a},$flags:{OneArg:!0}},import_from:{$meth(a){return o(E(a))},$flags:{OneArg:!0}}}),i(Sk.sysmodules,n("anvil.js.window"),c.window),c}var y=l(()=>{});function m(){let{abstr:{setUpModuleMethods:t},ffi:{toPy:n}}=Sk,r={__name__:n("server")};return t("server",r,{get_api_origin:{$meth(){return n(self.anvilLabsEndpoint)},$flags:{NoArgs:!0}}}),r}var g=l(()=>{});var v,S=l(()=>{y();g();v=new Map([["src/lib/anvil/__init__.py",""],["src/lib/anvil/js.js",`var $builtinmodule=${p};`],["src/lib/anvil/server.js",`var $builtinmodule=${m};`]])});function _(){let t={resolve:()=>{},reject:()=>{}};return t.promise=new Promise((n,r)=>{t.resolve=n,t.reject=r}),t}function j(t){let n=crypto.randomUUID();postMessage({type:"IMPORT",id:n,filename:t});let r=_();return f.set(n,r),r.promise}function M(){Sk.configure({output(t){return self.postMessage({type:"OUT",message:t})},yieldLimit:300,syspath:["app"],read(t){let n=v.get(t);return n!==void 0?n:Sk.misceval.promiseToSuspension(j(t).then(r=>{if(r==null)throw"No module named "+t;return r}))}}),Sk.builtins.self=Sk.ffi.proxy(self),u.resolve(!0)}function x(t){let{data:n}=t;if(n.type==="MODULE"){let{id:r,content:i}=n,{resolve:o}=f.get(r);f.delete(r),o(i)}}var u,f,k=l(()=>{S();u=_();f=new Map;self.addEventListener("message",x)});var U=D((h,L)=>{k();self.window=self;self.addEventListener("sync",t=>{b("sync",{tag:t.tag})});function O(){function t(n,r=[]){if(n.length!==1)throw new Sk.builtin.TypeError("Expeceted one arg to raise_event");let i={};for(let o=0;o<r.length;o+=2){let d=r[o],c=r[o+1];i[d]=c}b(n[0],r)}t.co_fastcall=!0,self.raise_event=new Sk.builtin.func(t)}self.onmessage=async e=>{console.log("%cDATA","color: blue;",e.data);let data=e.data,{type}=data;switch(type){case"SKULPT":{let skMod=await fetch(data.url);eval(await skMod.text()),M(),O();break}case"INIT":{await u.promise;let{name:t}=data;Sk.misceval.asyncToPromise(()=>Sk.importMain(t,!1,!0));break}}};async function w(t){t.ANVIL_LABS=!0;let n=await self.clients.matchAll({includeUncontrolled:!0,type:"window"});for(let r of n)r.postMessage(t)}self.postMessage=w;function b(t,n={}){n.event_name=t,w({type:"EVENT",name:t,kws:n})}});export default U();
