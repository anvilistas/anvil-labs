var f=(t,n)=>()=>(t&&(n=t(t=0)),n);var T=(t,n)=>()=>(n||t((n={exports:{}}).exports,n),n.exports);function p(){let{ffi:{proxy:t,toPy:n},abstr:{setUpModuleMethods:r,objectSetItem:a},misceval:{promiseToSuspension:s,chain:l}}=Sk,c={__name__:n("js"),window:t(self)};async function h(i){let o=await new Function("return import("+JSON.stringify(i.toString())+")").call(null);return t(o)}return r("js",c,{await_promise:{$meth(i){let o=i.valueOf();return o instanceof Promise||o&&o.then&&typeof o.then=="function"?l(s(o),L=>n(L,{dictHook:E=>t(E)})):i},$flags:{OneArg:!0}},import_from:{$meth(i){return s(h(i))},$flags:{OneArg:!0}}}),a(Sk.sysmodules,n("anvil.js.window"),c.window),c}var y=f(()=>{});var g,m=f(()=>{y();g=new Map([["src/lib/anvil/__init__.py",""],["src/lib/anvil/js.js",`var $builtinmodule=${p};`],["src/lib/anvil/server.js",""]])});function S(){let t={resolve:()=>{},reject:()=>{}};return t.promise=new Promise((n,r)=>{t.resolve=n,t.reject=r}),t}function j(t){let n=crypto.randomUUID();postMessage({type:"IMPORT",id:n,filename:t});let r=S();return d.set(n,r),r.promise}function v(){Sk.configure({output(t){return self.postMessage({type:"OUT",message:t})},yieldLimit:300,syspath:["app"],read(t){let n=g.get(t);return n!==void 0?n:Sk.misceval.promiseToSuspension(j(t).then(r=>{if(r==null)throw"No module named "+t;return r}))}}),Sk.builtins.self=Sk.ffi.proxy(self),u.resolve(!0)}function D(t){let{data:n}=t;if(n.type==="MODULE"){let{id:r,content:a}=n,{resolve:s}=d.get(r);d.delete(r),s(a)}}var u,d,w=f(()=>{m();u=S();d=new Map;self.addEventListener("message",D)});var x=T((_,b)=>{w();self.window=self;self.addEventListener("sync",t=>{M("sync",{tag:t.tag})});function O(){function t(n,r=[]){if(n.length!==1)throw new Sk.builtin.TypeError("Expeceted one arg to raise_event");let a={};for(let s=0;s<r.length;s+=2){let l=r[s],c=r[s+1];a[l]=Sk.ffi.toJs(c)}M(n[0].toString(),a)}t.co_fastcall=!0,self.raise_event=new Sk.builtin.func(t)}self.onmessage=async e=>{let data=e.data,{type}=data;switch(type){case"SKULPT":{let skMod=await fetch(data.url);eval(await skMod.text()),v(),O();break}case"INIT":{await u.promise;let{name:t}=data;Sk.misceval.asyncToPromise(()=>Sk.importMain(t,!1,!0));break}}};async function k(t){t.ANVIL_LABS=!0;let n=await self.clients.matchAll({includeUncontrolled:!0,type:"window"});for(let r of n)r.postMessage(t)}self.postMessage=k;function M(t,n={}){n.event_name=t,k({type:"EVENT",name:t,kws:n})}});export default x();
