async function c(e){let r=null;try{r=Sk.read(e),typeof r!="string"&&(r=await Sk.misceval.asyncToPromise(()=>r))}catch{if(e.startsWith("app/")){let[o,n,t]=e.split("/");t==="__init__.py"&&n!=="anvil"&&(r="pass")}else r=null}return r}async function l(){var n;let e=window.localforage;e===void 0&&(e=(await import("https://cdn.skypack.dev/pin/localforage@v1.10.0-vSTz1U7CF0tUryZh6xTs/mode=imports,min/optimized/localforage.js")).default);let r=e.createInstance({name:"anvil-labs-sw",storeName:"lib"});await r.ready();let o=await r.keys();for(let t of o){let a=r.getItem(t),s=(n=await c(t))!=null?n:0;s!==a&&r.setItem(t,s)}}var i,{builtin:{ExternalError:p},misceval:{callsimArray:y,callsimOrSuspendArray:f},ffi:{toPy:u}}=Sk;async function m(e){var a;let{data:r}=e;if(!r.ANVIL_LABS||r.type!=="IMPORT")return;let{filename:o,id:n}=r,t=await c(o);(a=i.active)==null||a.postMessage({type:"MODULE",content:t,id:n})}function g(e,r,o){let n;try{let t=Sk.builtin[e];n=y(t,r.map(a=>u(a))),n.traceback=o!=null?o:[]}catch{let t;try{t=new window[e](...r)}catch{t=new Error(...r)}n=new p(t)}return n}function k(e){let{data:r}=e;if(!r.ANVIL_LABS||r.type!=="ERROR")return;let{errorType:o,errorArgs:n,errorTb:t}=r,a=g(o,n,t),s=Sk.sysmodules.quick$lookup(u("anvil_labs.service_worker"));if(!s)throw a;let d=s.$d._error_handler;f(d,[a])}async function w(){i=await navigator.serviceWorker.register("_/theme/anvil_labs/sw.js");try{await i.update(),await l()}catch(e){console.error(e)}return navigator.serviceWorker.addEventListener("message",m),navigator.serviceWorker.addEventListener("message",k),i}var E=w;export{E as default,w as init,l as reloadModules};
